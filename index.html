<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Souqmarine Pi Sandbox</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>

<h2>Souqmarine Sandbox Payment</h2>
<button onclick="startPayment()">Pay 0.01 Test Pi</button>

<script>
Pi.init({ version: "2.0", sandbox: true });

async function startPayment() {
  try {
    const auth = await Pi.authenticate(['payments']);
    console.log("Auth OK:", auth);

    Pi.createPayment({
        amount: 0.01,
        memo: "Souqmarine Test Payment"
      },
      {
        onReadyForServerApproval: async function(paymentId) {
          console.log("Approving:", paymentId);

          await fetch("/api/approve_payment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ paymentId })
          });
        },

        onReadyForServerCompletion: async function(paymentId, txid) {
          console.log("Completing:", paymentId, txid);

          await fetch("/api/complete_payment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ paymentId, txid })
          });

          alert("✅ Payment Successful!");
        },

        onCancel: function() {
          alert("❌ Payment Cancelled");
        },

        onError: function(err) {
          console.error(err);
          alert("❌ Error: " + err.message);
        }
      }
    );

  } catch(e) {
    alert("Authentication failed");
  }
}
</script>

</body>
</html>
