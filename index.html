<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Souqmarine Sandbox Test</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>

  <h1>Souqmarine Sandbox</h1>
  <p>Maritime market Â· Powered by Pi Network</p>

  <button onclick="start()">Test Pi Payment</button>

  <script>
    // ğŸ”¹ Ø§Ø³ØªØ®Ø¯Ù… sandbox=true Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Pi Testnet
    Pi.init({
      version: "2.0",
      sandbox: true
    });

    async function start() {
      try {
        // ğŸ”¹ Authenticate Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¯ÙØ¹ (ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© 'payments' scope)
        const scopes = ['username', 'payments']; // Ø¶Ø±ÙˆØ±ÙŠ 'payments'
        const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);
        console.log("Authenticated:", auth);
        alert("Authentication successful âœ”ï¸");

        // ğŸ”¹ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ØµØ­ÙŠØ­Ø©
        Pi.createPayment(
          {
            amount: 0.01, // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ø§Ù„Ù€ Pi (Ø§Ø³ØªØ®Ø¯Ù… Test Pi)
            memo: "Souqmarine Sandbox Test", // ÙˆØµÙ Ø§Ù„Ø¯ÙØ¹
            metadata: { orderId: "test-001" } // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
          },
          {
            // ğŸ”¹ Callback: Ø£Ø±Ø³Ù„ paymentId Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø© (Ù‡Ù†Ø§ console.log Ù…Ø¤Ù‚ØªÙ‹Ø§)
            onReadyForServerApproval: function(paymentId) {
              console.log("Ready for approval:", paymentId);
              // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬: fetch('/your-backend/approve', { method: 'POST', body: JSON.stringify({ paymentId }) })
              alert("Payment ready for approval âœ”ï¸");
            },
            // ğŸ”¹ Callback: Ø£Ø±Ø³Ù„ txid Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù„Ø¥ÙƒÙ…Ø§Ù„
            onReadyForServerCompletion: function(paymentId, txid) {
              console.log("Completion:", paymentId, txid);
              // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬: fetch('/your-backend/complete', { method: 'POST', body: JSON.stringify({ paymentId, txid }) })
              alert("Payment completed successfully âœ”ï¸ TxID: " + txid);
            },
            onCancel: function(paymentId) {
              console.log("Cancelled:", paymentId);
              alert("Payment cancelled âŒ");
            },
            onError: function(error, payment) {
              console.error("Error:", error);
              alert("Payment error âŒ: " + error.message);
            }
          }
        );

      } catch (err) {
        alert("Authentication failed âŒ\nØªØ£ÙƒØ¯ Ù…Ù† ØªÙÙˆÙŠØ¶ Sandbox Ø¯Ø§Ø®Ù„ Pi Utilities");
        console.error(err);
      }
    }

    // ğŸ”¹ Function Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¯ÙØ¹Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© (Ù…Ø·Ù„ÙˆØ¨Ø©)
    function onIncompletePaymentFound(payment) {
      console.log("Incomplete payment found:", payment);
      // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬: Ø£Ø±Ø³Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
    }
  </script>

</body>
</html>
