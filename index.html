<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Souqmarine Sandbox Test</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>

  <h1>Souqmarine Sandbox</h1>
  <p>Maritime market Â· Powered by Pi Network</p>

  <button onclick="start()">Test Pi Payment</button>

  <script>
    // ğŸ”¹ Ø§Ø³ØªØ®Ø¯Ù… sandbox=true Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Pi Testnet
    Pi.init({
      version: "2.0",
      sandbox: true
    });

    // ğŸ”¹ Function Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¯ÙØ¹Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© (Ù…Ø·Ù„ÙˆØ¨Ø©)
    function onIncompletePaymentFound(payment) {
      console.log("Incomplete payment found:", payment);
      alert("Ø¯ÙØ¹Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©: " + payment.identifier);
      // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬: Ø£Ø±Ø³Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
    }

    async function start() {
      try {
        // ğŸ”¹ Authenticate Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¯ÙØ¹
        const scopes = ['username', 'payments']; // Ø¶Ø±ÙˆØ±ÙŠ 'payments'
        const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);
        console.log("Authenticated:", auth);
        alert("Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù†Ø§Ø¬Ø­Ø© âœ”ï¸\nØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + auth.user.username);

        // ğŸ”¹ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ØµØ­ÙŠØ­Ø©
        Pi.createPayment(
          {
            amount: 0.01, // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ø§Ù„Ù€ Test Pi
            memo: "Souqmarine Sandbox Test", // ÙˆØµÙ
            metadata: { orderId: "test-001" } // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
          },
          {
            onReadyForServerApproval: function(paymentId) {
              console.log("Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©:", paymentId);
              alert("Ø§Ù„Ø¯ÙØ¹ Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø© âœ”ï¸ ID: " + paymentId);
              // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬: Ø£Ø±Ø³Ù„ paymentId Ø¥Ù„Ù‰ backend Ø¨Ù€ fetch POST
            },
            onReadyForServerCompletion: function(paymentId, txid) {
              console.log("Ù…ÙƒØªÙ…Ù„:", paymentId, txid);
              alert("Ø§Ù„Ø¯ÙØ¹ Ù…ÙƒØªÙ…Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ”ï¸ TxID: " + txid);
              // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬: Ø£Ø±Ø³Ù„ txid Ø¥Ù„Ù‰ backend
            },
            onCancel: function(paymentId) {
              console.log("Ù…Ù„ØºÙŠ:", paymentId);
              alert("Ø§Ù„Ø¯ÙØ¹ Ù…Ù„ØºÙŠ âŒ");
            },
            onError: function(error, payment) {
              console.error("Ø®Ø·Ø£:", error);
              alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯ÙØ¹ âŒ: " + error.message);
            }
          }
        );

      } catch (err) {
        console.error(err);
        alert("ÙØ´Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© âŒ\nØªØ£ÙƒØ¯ Ù…Ù† ØªÙÙˆÙŠØ¶ Sandbox ÙÙŠ Pi Utilities.\nØ®Ø·Ø£: " + err.message);
      }
    }
  </script>

</body>
</html>
